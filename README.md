# IR Image Viewer - 红外图像二进制数据查看器

一个基于PyQt5的桌面应用程序，用于加载、显示和分析二进制格式的红外图像数据。

## 功能特性

### 核心功能
- **多格式支持**: 支持8位和16位灰度图像数据
- **灵活配置**: 可配置图像分辨率、字节序（大端/小端）、行偏移量
- **多帧播放**: 支持包含多帧图像的二进制文件，可播放动画序列
- **图像查看**: 提供缩放、平移、像素信息显示等功能
- **十六进制查看**: 以十六进制格式查看原始二进制数据
- **搜索功能**: 在十六进制视图中搜索特定的字节模式
- **大文件优化**: 对超过100MB的文件自动使用内存映射技术

### 支持的图像分辨率
- 640×512 (默认)
- 320×256
- 1280×1024
- 自定义分辨率

### 16位图像增强显示
- **自动直方图映射**: 16位图像通常只使用0-65535范围的一小部分（如1000-5000），应用程序会自动检测实际使用的值范围并拉伸到0-255，确保图像清晰可见
- **百分位数拉伸**: 使用0.1%和99.9%百分位数来确定映射范围，自动忽略极端值
- **避免全黑显示**: 解决了16位图像显示为全黑的常见问题

## 安装

### 系统要求
- Python 3.8 或更高版本
- PyQt5
- NumPy
- Pillow

### 安装步骤

#### 方法1: 使用 pip 安装
```bash
pip install -e .
```

#### 方法2: 手动安装依赖
```bash
pip install -r requirements.txt
```

## 使用方法

### 启动应用程序

#### 基本启动
```bash
python main.py
```

#### 启动时加载文件
```bash
python main.py data/sample.bin
```

或使用 `-f` 参数:
```bash
python main.py -f data/sample.bin
```

#### 查看帮助信息
```bash
python main.py --help
```

#### 查看版本信息
```bash
python main.py --version
```

### 使用界面

#### 1. 加载文件
- 点击菜单栏 **文件 → 打开** 或工具栏的 **打开** 按钮
- 选择要加载的二进制图像文件
- 文件信息将显示在状态栏

#### 2. 配置图像参数
在左侧控制面板中配置以下参数：

- **分辨率**: 从下拉列表选择图像分辨率（如 640×512）
- **位深度**: 选择 8位 或 16位
- **字节序**: 选择 小端 或 大端（仅16位图像）
- **行偏移**: 设置数据起始位置的偏移量

#### 3. 查看图像
- 图像将自动显示在主视图区域
- 使用工具栏按钮进行缩放：
  - **放大**: 放大图像
  - **缩小**: 缩小图像
  - **适应窗口**: 自动调整图像大小以适应窗口
- 鼠标悬停在图像上可查看像素坐标和值

#### 4. 多帧操作
如果文件包含多帧图像：
- 使用控制面板中的 **前进/后退** 按钮切换帧
- 点击 **播放** 按钮自动播放所有帧
- 点击 **暂停** 按钮停止播放
- 当前帧号和总帧数显示在控制面板

#### 5. 十六进制查看
- 切换到 **十六进制视图** 标签页
- 查看文件的原始二进制数据
- 每行显示：地址偏移量 | 十六进制数据 | ASCII字符
- 使用搜索功能查找特定的字节模式

#### 6. 搜索功能
在十六进制视图中：
- 输入要搜索的十六进制模式（如 "FF00"）
- 点击搜索按钮
- 所有匹配位置将被高亮显示
- 视图自动滚动到第一个匹配位置

## 项目结构

```
ir-image-viewer/
├── main.py                     # 应用程序入口点
├── README.md                   # 本文件
├── requirements.txt            # Python依赖
├── setup.py                    # 安装配置
├── src/                        # 源代码目录
│   ├── __init__.py
│   ├── ui/                     # UI组件
│   │   ├── main_window.py      # 主窗口
│   │   ├── image_view.py       # 图像视图
│   │   ├── hex_view.py         # 十六进制视图
│   │   └── control_panel.py    # 控制面板
│   ├── core/                   # 核心功能
│   │   ├── file_loader.py      # 文件加载器
│   │   ├── image_parser.py     # 图像解析器
│   │   ├── frame_manager.py    # 帧管理器
│   │   └── data_models.py      # 数据模型
│   └── utils/                  # 工具函数
│       ├── error_handler.py    # 错误处理
│       └── converters.py       # 数据转换
└── tests/                      # 测试文件
    ├── test_file_loader*.py
    ├── test_image_parser.py
    ├── test_image_view.py
    ├── test_hex_view.py
    └── test_main_window.py
```

## 开发

### 运行测试
```bash
# 运行所有测试
pytest

# 运行特定测试文件
pytest tests/test_file_loader_basic.py

# 运行带覆盖率报告的测试
pytest --cov=src tests/
```

### 代码风格
项目遵循 PEP 8 Python代码风格指南。

## 技术细节

### 数据格式
应用程序支持以下二进制图像格式：
- **8位灰度**: 每像素1字节，值范围 0-255
- **16位灰度**: 每像素2字节，值范围 0-65535
- **字节序**: 支持小端（Little Endian）和大端（Big Endian）

### 16位图像显示技术
应用程序使用先进的直方图映射技术来正确显示16位图像：
- **自动对比度增强**: 检测实际使用的值范围并拉伸到0-255
- **百分位数拉伸**: 使用0.1%和99.9%百分位数，自动忽略异常值
- **解决全黑问题**: 16位红外图像通常只使用0-65535范围的一小部分（如1000-5000），直方图映射确保这些图像清晰可见

详细技术说明请参考：[docs/HISTOGRAM_MAPPING.md](docs/HISTOGRAM_MAPPING.md)

### 性能优化
- **大文件处理**: 超过100MB的文件使用内存映射（mmap）
- **虚拟滚动**: 十六进制视图仅渲染可见区域
- **帧缓存**: 缓存最近访问的帧以提高性能
- **高效映射**: 直方图映射计算优化，对640×512图像仅需几毫秒

### 架构设计
采用模型-视图-控制器（MVC）架构：
- **模型**: 数据模型和业务逻辑（core/）
- **视图**: UI组件（ui/）
- **控制器**: 主窗口协调各组件交互

## 常见问题

### Q: 图像显示不正确怎么办？
A: 检查以下配置：
- 分辨率是否与实际图像匹配
- 位深度设置是否正确（8位或16位）
- 对于16位图像，尝试切换字节序
- 调整行偏移量

### Q: 文件加载失败？
A: 确保：
- 文件路径正确且文件存在
- 有读取文件的权限
- 文件不是空文件
- 文件大小足以包含至少一帧完整图像

### Q: 如何处理大文件？
A: 应用程序会自动对超过100MB的文件使用内存映射技术，无需特殊配置。

### Q: 支持哪些图像格式？
A: 本应用专门用于二进制原始数据（raw binary data），不支持PNG、JPEG等标准图像格式。

## 许可证

本项目采用 MIT 许可证。

## 贡献

欢迎提交问题报告和功能请求！

## 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 Issue
- 发送 Pull Request

## 更新日志

### v1.0.0 (2024)
- 初始版本发布
- 支持8位和16位灰度图像
- 图像查看和十六进制查看功能
- 多帧播放支持
- 搜索功能
