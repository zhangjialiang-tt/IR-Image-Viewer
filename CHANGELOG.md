# 更新日志

本文档记录IR Image Viewer的所有重要更改。

## [未发布] - 2024-12-16

### 新增功能

#### 16位数据类型支持
- ✨ 添加有符号/无符号数据类型选择（仅16位）
- 🔢 无符号（uint16）：0-65535，适用于大多数红外图像
- ➖ 有符号（int16）：-32768-32767，适用于包含负值的数据
- 🎯 8位时自动禁用数据类型选项
- 🔄 16位时自动启用数据类型选项
- 📊 直方图映射自动支持有符号数据（包含负值）

#### 参数实时刷新
- ✨ 修改分辨率、位深度、数据类型、字节序或文件偏移时，自动刷新图像和十六进制视图
- 🔄 无需重新加载文件，参数变更立即生效
- 🎯 十六进制视图智能显示：只显示当前配置对应的图像数据范围（offset + image_length）
- ⚡ 实时反馈，提升用户体验

#### 自定义分辨率支持
- ✨ 添加自定义分辨率功能，用户可以输入任意宽度和高度（1-10000像素）
- 🎯 两种设置方式：
  1. 从分辨率下拉框选择"自定义..."
  2. 点击"设置自定义分辨率..."按钮
- 💾 自定义分辨率会被保存并显示在下拉框中，方便重复使用
- ✅ 输入验证：确保分辨率值在有效范围内

#### 16位图像直方图映射
- 🎨 实现自动直方图映射，解决16位图像显示为全黑的问题
- 📊 使用百分位数拉伸（0.1%和99.9%），自动忽略异常值
- ⚡ 对比度改善高达15.9倍
- 🔧 可选择启用或禁用直方图映射
- 📚 详细技术文档：`docs/HISTOGRAM_MAPPING.md`

### 改进

#### 术语更正
- 📝 将"行偏移"更名为"文件偏移"，更准确地描述功能
- 💡 添加说明文字："从文件的第N个字节开始读取"
- 📖 更新所有相关文档和代码注释
- 🔢 增加文件偏移的最大值到100,000,000字节，支持大文件

#### 用户界面
- 🎨 改进控制面板布局
- 📝 添加工具提示和说明文字
- ✨ 自定义分辨率对话框提供友好的输入界面

#### 文档
- 📚 创建`docs/HISTOGRAM_MAPPING.md`技术文档
- 📝 更新`README.md`和`USAGE_EXAMPLES.md`
- 🎯 添加20+个使用示例
- 🧪 创建演示脚本`examples/demo_histogram_mapping.py`

### 测试

- ✅ 添加12个直方图映射测试（全部通过）
- ✅ 添加自定义分辨率功能测试
- ✅ 验证文件偏移功能正常工作

### 技术细节

#### 直方图映射实现
```python
def apply_histogram_mapping(array, percentile_low=0.1, percentile_high=99.9):
    """使用百分位数拉伸增强对比度"""
    vmin = np.percentile(array, percentile_low)
    vmax = np.percentile(array, percentile_high)
    return clip_and_normalize(array, vmin, vmax)
```

#### 自定义分辨率对话框
```python
class CustomResolutionDialog(QDialog):
    """允许用户输入任意分辨率"""
    - 宽度输入：1-10000像素
    - 高度输入：1-10000像素
    - 输入验证和错误提示
```

### 性能

- ⚡ 直方图映射计算：O(n log n)
- 💾 640×512图像处理时间：~几毫秒
- 🚀 对用户体验无明显影响

## [1.0.0] - 2024

### 初始版本

#### 核心功能
- 📂 加载和显示二进制图像文件
- 🖼️ 支持8位和16位灰度图像
- 🔄 支持大端和小端字节序
- 📐 预设分辨率：320×256, 640×512, 800×600, 1024×768, 1280×1024, 1920×1080
- 🎬 多帧图像播放
- 🔍 图像缩放和像素信息查看
- 🔢 十六进制数据查看
- 🔎 十六进制搜索功能

#### 性能优化
- 💾 大文件（>100MB）自动使用内存映射
- 📜 十六进制视图虚拟滚动
- 🎯 帧缓存机制

#### 文档
- 📚 完整的README.md
- 📖 详细的使用示例
- 🛠️ 开发者文档
- 📦 安装说明

---

## 图例

- ✨ 新功能
- 🎨 UI改进
- 📝 文档更新
- 🐛 Bug修复
- ⚡ 性能改进
- 🔧 配置更改
- 📚 文档
- ✅ 测试
- 🔒 安全
- 💾 数据处理
- 🎯 用户体验
